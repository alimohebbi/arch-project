\chapter{گام دوم}\label{chap:2}
\section{بررسی ‌الگوهای مولفه اتصال مختلف در سامانه‌ی ما}

\زیرقسمت{الگوی ‌‌Broker}

الگوی ‌‌Broker سخن از این نکته می‌گوید که در سامانه‌هایی که سیستم مجموعه‌ای از سرویس‌های توزیع‌شده است  پیاده‌سازی مشکل خواهد بود و ارتباط  اجزای سیستم و در دسترس بودن سرویس‌های کامپوننت‌های مختلف برای ما مشکل‌ساز خواهد شد. لزوم اطلاع از مکان و نوع سرویس‌ها از سوی  کاربران  برای استفاده از سرویس‌ها باعث ایجاد و تقویت مشکلات ذکر شده خواهد شد. راه حلی که این الگو پیشنهاد میدهد استفاده از یک میانجی است که در مورد سویس‌ها اطلاع دارد و کاربران و سرویس‌دهندگان به جای اتصال به یکدیگر به آن متصل می‌شوند. با توجه به اینکه سامانه ما یک سیستم توزیع شده است که سرویس‌هایی در آن ارائه می‌شود، قاعدتا با مشکلات گفته شده مواجه خواهیم شد لذا راه حلی که این الگو  ارائه داده است  برای سامانه‌ای مشابه سامانه ما مناسب به نظر می‌رسد.



\زیرقسمت{الگوی ‌‌Model-View-Controller}

مسئله‌ای که این الگو به آن توجه کرده است تغییرات مداوم واسط کاربری است، بدین معنا که کاربران اطلاعات مختلف را به اشکال مختلف خواهند دید و با آن تعامل خواهند داشت و لذا بسیار  مفید خواهد بود اگر این واسط در عین اینکه  حالت فعلی اطلاعات را به کاربران نشان می‌دهد عملکردی مستقل از عملکرد کاربردی سیستم داشته باشد. راه حلی که این الگو ارائه داده است تقسیم عملکرد سیستم بین سه مولفه model ، view و controller است. مولفه view وظیفه‌ی نمایش بخش‌هایی از داده و تعامل با کاربران را بر عهده دارد، model شامل داده‌های سامانه می‌شود و controller میانجی بین این دو است و مدیریت اخطارهای تغییر حالت را بر عهده دارد. به طور کلی در شبکه‌های اجتماعی و سامانه‌های پیام‌رسان با توجه به اینکه تعداد کاربران هم بسیار بالا است و سیستم بایستی با کاربران تعامل داشته باشد واسط‌کاربری و تغییرات آن برای ما حیاتی خواهد شد.علاوه بر این جذابیت چنین سامانه‌ای برای جذب کاربران اهمیت دارد لذا اگر امکانات شخصی سازی در  واسط‌کاربری به کاربران داده شود تاثیر خوبی خواهد داشت. با توجه به همه‌ی این نکات الگوی MVC برای سامانه‌ی ما مناسب به نظر می‌رسد.


\زیرقسمت{الگوی \متن‌لاتین{ ‌‌Pipe and Filter}}

این الگو در سیستم‌هایی که تغییر شکل ِداده‌ها مرتبا رخ می‌دهد مورد نیاز است. این تبدیل شکل داده‌ها اگر بخواهد در چنین سیستمی بدون هیچ الگویی مرتبا انجام شود و هر کدام بارها و بارها جداگانه پیاده شود تبعا کارایی و قابلیت مقیاس‌پزیری را به شدت تحت تاثیر قرار می‌دهد، لذا این الگو با انجام این فرایند بر روی مولفه‌های مستقل   و و قابل استفاده مجدد که حتی قابلیت اجرای موازی را هم دارند ویژگی‌های کیفی را بهبود می‌بخشد. راه‌حل این الگو این است که داده‌ها در مولفه‌هایی به نام فیلتر \پانویس {Filter}تغییر شکل می‌یابند و توسط رابط‌هایی به نام لوله‌\پانویس{Pipe} بین فیلترها جابه‌جا می‌شوند. با توجه به اینکه ما در سامانه خود تغییر شکل‌‌‌ داده‌ی زیادی نداریم این الگو برای سامانه ما کارایی خاصی ندارد و چندان مناسب نیست.


\زیرقسمت{الگوی ‌‌Client-Server}

این الگو تمرکز خود را بر روی زمانی می‌گذارد که تعداد زیادی مشتری\پانویس{Client} قصد دسترسی به منابع و یا سرویس‌های اشتراکی دارند و برای هر کدام بایستی دسترسی و کیفیت سرویس کنترل شود. وقتی که سرویس‌های مشترک بیرون کشیده شوند و در یکجا قرار گیرند نیازی نیست که در هر تغییر چیزهای زیادی تغییر کنند و همه در یک یا نقاط محدودی متمرکز شده‌اند که این باعث افزایش قابلیت تغییر و قابلیت مقیاس‌پذیری می‌شود و قابلیت استفاده مجدد را نیز افزایش می‌دهد. راه حلی که این الگو ارائه می‌دهد این نقاط متمرکز ارائه دهنده سرویس را سرور در نظر می‌گیرد و استفاده‌کننده‌ها را کلاینت و نیز یک مولفه قادر است هم کلاینت باشد و هم سرور. قابلیت وجود یک سرور مرکزی و یا چند سرور توزیع شده هم در این الگو وجود دارد تنها شرطی که در این الگو  اعمال می‌شود این است که  حتما یک  مشتری شروع کننده‌ی یک تعامل است. با توجه به اینکه در سامانه‌ی ما نیز مشتری‌ها یا همان کلاینت‌ها از یک سری سرویس‌های ارائه شده استفاده می‌کنند چنین الگویی می‌تواند با تنظیمات مختلفی مثل چندین سروری استفاده شود.

\زیرقسمت{الگوی Peer-to-Peer}

این الگو به بیان شرایطی می‌پردازد که در آن موجودیت‌های محاسباتی توزیع‌شده‌ای داریم که همه‌ی آن‌ها به یک اندازه حق دارند آغازکننده یک تعامل باشند و هر یک از آن‌ها منابع خودش را داشته و با همکاری با یکدیگر قراراست که به یک مجموعه‌ای از کاربران توزیع‌شده سرویس بدهند. راه‌حل ارائه شده‌ توسط این الگو موجودیت‌ها را peer می‌نامد که آن‌ها از طریق رابط‌هایی با یکدیگر در ارتباط هستند. این الگو مشابه الگوی کلاینت سرور است و تنها تفاوت آن در تقارنی است که بین peerها بر قرار است. با وجود اینکه این الگو می‌تواند در یک سامانه پیام‌رسان یا شبکه اجتماعی مورد استفاده قرار گیرد ولی چون ما در نظر نداریم امکان ارائه سرویس مستقیمی بر روی کلاینت‌ها وجود داشته باشد این الگو چندان برای سامانه ما مناسب به نظر نمی‌رسد.



\زیرقسمت{الگوی\متن‌لاتین{Service Oriented Architecture }}
موقعیتی که در بکارگیری این الگو بکار می‌رود زمانی است که تعدادی سروریس توسط فراهم کنندگان سرویس ارائه شده است و تعدادی مصرف کننده آنها را مصرف می‌کنند و لازم است مصرف کنندگان لازم است این سرویس‌ها را درک کنند و بتوانند از آنها استفاده کنند بدون آنکه از جزئیات پیاده‌سازی سرویس‌ها با خبر باشند. در سامانه‌ی پیام رسان مصرف کنندگان و فراهم کنندگان سرویس را می‌توان قطعات مختلف در نظر گرفت. مسئله‌ای که این الگو حل می‌کند همکاری بین قطعات مختلف در زمان اجرا است که می‌توانند با زبانهای برنامه نویسی مختلفی نوشته شده باشند. در بررسی سامانهای پیام‌رسان مشاهده شد که اجزاء مختلف می‌توانند زبانها و platform های مختلف داشته باشند.\مرجع{TheWhats:online}\مرجع{ScalingT:online} \\
همانطور که در قسمت \رجوع{sec:soa}  به طور مفصل درباره‌ی بکارگیری این الگو توضیح داده شد، این الگو در سامانه‌ی پیام‌ رسان می‌تواند نقش اساسی را ایفا کند.

\زیرقسمت{الگوی  Publish-Subscribe}
این الگو زمانی بکار برده می‌شود که تعداد زیادی تولید کننده و مصرف کننده داده وجود دارد که لازم است به صورت مستقل تعامل برقرار کنند. تعداد این تولید کنندگان و مصرف کنندگان نامشخص و غیر ثابت است. چنین شرایطی را در سامانه‌ی پیام رسان نیز داریم. تعداد کاربران زیاد است، نامشخص و متغیر و مستقل از هم هستند و هر یک تولید کننده و مصرف کننده‌ی مستقل هستند. مسئله‌ای که این الگو حل می‌کند وجود یک مکانیزم مجتمع برای انتقال اطلاعات بین این اجزاء است که آنها از هویت یکدیگر یا حتی از وجود هم بی خیر هستند. \\
یک نمونه از مورد کاربردی که این الگو در سامانه‌ی پیام رسان دارد می‌تواند داشته باشد این است که کاربران وضعیت خود را به روز رسانی کنند یا رویدادی را به اطلاع سایرین برسانند. به عنوان مثال آنلاین یا آفلاین بودن خود را با دیگر کاربران به اشتراک بگذارند.

\زیرقسمت{الگوی Shared-Data \برچسب{share-data}}
در هنگامی که قطعات  \پانویس{Component} محاسباتی مختلف نیازمند آن هستند که حجم بزرگی از داده‌ها را به اشتراک بگذارند و این داده‌ها به قطعه‌ی خاصی تعلق ندارد. در سامانه‌ی پیام‌ رسان نیز حجم داده‌ها فراوان است. این الگو مسئله‌ای که حل می‌کند عبارت است از ذخیره‌سازی و تغییر داده‌های پایدار در سامانه که این داده‌ها توسط چندین قطعه مورد دسترسی قرار می‌گیرند. در جایی دیگر بیان شده که ارتباط بین قطعات به واسطه‌ی مخزن داده‌ی مشترک  \پانویس{Shared Data Store}انجام می‌گیرد. در صورتی که در سامانه‌ی پیام رسان قطعات راههای ارتباطی دیگری نیز دارند. همچنین در توضیحات این الگو مشخص شده است که کدام قطعات به کدام مخازن متصل هستند که این رابطه نیز می‌تواند در سامانه‌ی پیام رسان وجود داشته باشد. به طور کلی اگر پیاده‌سازی این الگو را در قالب پایگاه داده‌های تجاری در نظر بگیریم برای سامانه‌ی پیام رسان مناسب است و در غیر این صورت مناسب نیست.
\section{انتخاب الگو}
از میان الگوهای بررسی شده الگوهای pub/sub ، SOA ، ‌Broker ، Share-Data انتخاب شدند. ‌Broker ‌در انتقال فایلهای رسانه‌ای بکار برده شد. SOA روابط بین مولفه ها و تقسیم بندی آنها را شامل می‌شود.  از pub/sub به جهت انتشار وضعیت کاربران استفاده می‌شود. از Share-Data  طبق توضیحات قسمت \رجوع{share-data} در استفاده از پایگاه داده پیاده سازی شده است.
















